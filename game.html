<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        canvas {
            border: 1px solid #d3d3d3;
            background-color: #f1f1f1;
        }
    </style>
</head>
<body onload="startGame()">
<script>
//
//     window.addEventListener("keydown", movePlatform, false);
//     iRefresh = window.setInterval(updateGameArea,20);
//

    var myGamePiece;
    var myObstacle;
    var myBall;
    var myOpponentList = [];
    let keyboardEventListenerDown;
    let keyboardEventListenerUp;


    function startGame() {
        myGamePiece = new component(60, 10, "red", 210, 250);
        myBall = new ballComponent(5, "green", 240, 245);
        keyboardEventListenerDown = window.addEventListener("keydown", movePlatform, true);
        keyboardEventListenerUp = window.addEventListener("keyup", clearMove, true);
        for (let j = 0; j < 5; j++) {
            for (let i = 0; i < 12; i++) {
                myOpponentList.push(new component(38, 10, "green", 1 + i * (40), j * (10 + 2)));
            }
        }
        myGameArea.start();
    }

    var myGameArea = {
        canvas: document.createElement("canvas"),
        start: function () {
            this.canvas.width = 480;
            this.canvas.height = 270;
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            this.interval = setInterval(updateGameArea, 20);
            // opponents()
        },
        clear: function () {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        }
    }

    function component(width, height, color, x, y) {
        this.width = width;
        this.height = height;
        this.speedX = 0;
        this.speedY = 0;
        this.x = x;
        this.y = y;
        this.update = function () {
            ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
        this.newPos = function () {
            if (this.x >= 0 && this.speedX < 0 || this.x <= 480 - this.width && this.speedX > 0) {
                this.x += this.speedX;
            }
            this.y += this.speedY;
        }
    }

    function ballComponent(radius, color, x, y) {

        this.radius = radius;
        this.baseSpeed = 4
        this.speedX = 0;
        this.speedY = (-1)*this.baseSpeed;
        this.x = x;
        this.y = y;
        this.update = function () {
            ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, 360);
            ctx.stroke();
            ctx.closePath();
            ctx.fillStyle = "red";
            ctx.fill();

        }
        this.newPos = function () {
            this.x += this.speedX;
            this.y += this.speedY;

            if(this.x - this.radius <=0){
            this.speedX = -this.speedX;
            }
            else if(this.x + this.radius >=480){
            this.speedX = -this.speedX;
            }
            if(this.y - this.radius <=0){
                this.speedY= -this.speedY;
            }
            else if(this.y + this.radius >= 270){
                this.speedY= -this.speedY;
                console.log("GAME OVER");
            }
            if(this.y+this.radius >= myGamePiece.y && (this.x+this.radius >= myGamePiece.x &&this.x-this.radius <= myGamePiece.x + myGamePiece.width)){
            this.speedY= -this.speedY;
            this.speedX= (this.x - (myGamePiece.x + myGamePiece.width/2))/(myGamePiece.width/3);
            console.log(this.speedX)
            this.speedY=  Math.sqrt(Math.pow(this.baseSpeed,2) - Math.pow(this.speedX,2)) * (-1);
            console.log("kontakt")
            }



//             if
        }
    }


    function updateGameArea() {
        myGameArea.clear();
        myBall.newPos();
        myBall.update();
        myGamePiece.newPos();
        myGamePiece.update();
        for (let i = 0; i < myOpponentList.length; i++) {
            myOpponentList[i].update()
        }
    }



    function moveLeft() {
        myGamePiece.speedX = -3;
    }

    function moveRight() {
        myGamePiece.speedX = 3;
    }

    function movePlatform(e) {
        switch(e.keyCode) {
            case 37:
                moveLeft();
                break;
            case 39:
                moveRight()
                break;
        }
    }

    function clearMove() {
        myGamePiece.speedX = 0;
    }




</script>
<div style="text-align:center;width:480px;">

    <button onmousedown="moveLeft()" onmouseup="clearMove()" ontouchstart="moveLeft()">LEFT</button>
    <button onmousedown="moveRight()" onmouseup="clearMove()" ontouchstart="moveRight()">RIGHT</button>
    <br><br>

</div>
<p>Now there is an obstacle in our gaming area, but still nothing happens when the red square hits it.</p>
</body>
</html>
